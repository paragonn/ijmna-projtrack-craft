{% set changeColorCon = changeDefaultColor ? changeDefaultColor and opacity < 55 and opacity != 'none' : false %}

{% set backgroundColors = {
    'none'       : 'text-blue-800',
    'white'      : 'text-blue-800',
    'light-blue' : 'text-blue-800',
    'blue-100'   : 'text-blue-800',
    'blue'       : changeColorCon ? 'text-blue-800' : 'text-white',
    'blue-600'   : changeColorCon ? 'text-blue-800' : 'text-white',
    'blue-700'   : changeColorCon ? 'text-blue-800' : 'text-white',
    'blue-800'   : changeColorCon ? 'text-blue-800' : 'text-white'
} %}

{% set linkColors = {
    'none'       : 'text-blue-800 hover:text-blue-500',
    'white'      : 'text-blue-800 hover:text-blue-500',
    'light-blue' : 'text-blue-800 hover:text-blue-500',
    'blue-100'   : 'text-blue-800 hover:text-blue-500',
    'blue'       : changeColorCon ? 'text-blue-800 hover:text-blue-500' : 'text-white hover:text-white/80',
    'blue-600'   : changeColorCon ? 'text-blue-800 hover:text-blue-500' : 'text-white hover:text-white/80',
    'blue-700'   : changeColorCon ? 'text-blue-800 hover:text-blue-500' : 'text-white hover:text-blue-500',
    'blue-800'   : 'text-white hover:text-blue-500'
} %}

{% set markerColor = {
    'none'       : 'marker:text-blue-500',
    'white'      : 'marker:text-blue-500',
    'light-blue' : 'marker:text-blue-500',
    'blue-100'   : 'marker:text-blue-500',
    'blue'       : changeColorCon ? 'marker:text-blue-500' : 'marker:text-white',
    'blue-600'   : changeColorCon ? 'marker:text-blue-500' : 'marker:text-white',
    'blue-700'   : changeColorCon ? 'marker:text-blue-500' : 'marker:text-white',
    'blue-800'   : changeColorCon ? 'marker:text-blue-500' : 'marker:text-white'
} %}

{% set checkboxColor = {
    'none'       : 'border-blue-800 checked:border-blue-800 text-blue-800',
    'white'      : 'border-blue-800 checked:border-blue-800 text-blue-800',
    'light-blue' : 'border-blue-500 checked:border-blue-500 text-blue-500',
    'blue-100'   : 'border-blue-800 checked:border-blue-800 text-blue-800',
    'blue'       : changeColorCon ? 'border-blue-500 checked:border-blue-500 text-blue-500' : 'border-white checked:border-blue-950 text-blue-950',
    'blue-600'   : changeColorCon ? 'border-blue-500 checked:border-blue-500 text-blue-500' : 'border-white checked:border-blue-950 text-blue-950',
    'blue-700'   : 'border-blue-400 checked:border-blue-800 text-blue-800',
    'blue-800'   : 'border-blue-400 checked:border-blue-800 text-blue-800'
} %}

{% set borderColor = {
    'none'       : 'border-blue-950',
    'white'      : 'border-blue-950',
    'light-blue' : 'border-blue-950',
    'blue-100'   : 'border-blue-950',
    'blue'       : changeColorCon ? 'border-blue-950' : 'border-gray-100 !border-l-white',
    'blue-600'   : changeColorCon ? 'border-blue-950' : 'border-gray-100 !border-l-white',
    'blue-700'   : 'border-blue-950',
    'blue-800'   : 'border-blue-950'
} %}

{% set blockquoteColor = {
    'none'       : 'border-blue-50/20 !border-l-blue-500',
    'white'      : 'border-blue-50/20 !border-l-blue-500',
    'light-blue' : 'border-blue-50/20 !border-l-blue-500',
    'blue-100'   : 'border-blue-50/20 !border-l-blue-500',
    'blue'       : changeColorCon ? 'border-blue-50/20 !border-l-blue-500' : 'border-gray-100 !border-l-white',
    'blue-600'   : changeColorCon ? 'border-blue-50/20 !border-l-blue-500' : 'border-gray-100 !border-l-white',
    'blue-700'   : 'border-blue-50/20 !border-l-blue-500',
    'blue-800'   : 'border-blue-50/20 !border-l-blue-500'
} %}

{% set classes = extraClasses|length ? extraClasses ~ ' ' : '' %}
{% set color = forceTextColor|default(backgroundColors[background]) %}
{% set linkColor = forceTextColor|default(linkColors[background]) %}
{% set paragraphFontSize = paragraphFontSize|default('text-base') %}
{% set spacingClass = spacingClass|length ? spacingClass %}
{% set listStyle = contentAlignment != 'left' ? 'list-inside' %}
{% set listPaddingLeft = listPaddingLeft|default('pl-9') %}
{% set tableBorder = background in ['blue', 'blue-600', 'blue-700', 'blue-800'] ? 'even:bg-gray-100 odd:bg-white' : 'even:bg-blue-50/5 odd:bg-white' %}
{% set blockquoteClass = blockquoteColor[background] %}
{% set borderClass = borderColor[background] %}
{% set fontFamily = fontFamily ?? 'font-Baskervville' %}

{% set h1 = h1|default("text-4xl/tight lg:text-5xl/tight uppercase font-Baskervville") %}
{% set h2 = h2|default("text-3xl lg:text-4xl font-Baskervville") %}
{% set h3 = h3|default("text-2xl lg:text-3xl font-Baskervville") %}
{% set h4 = h4|default("text-xl lg:text-2xl font-Baskervville") %}
{% set h5 = h5|default("text-lg lg:text-xl font-Baskervville") %}
{% set h6 = h6|default("text-base lg:text-lg font-Baskervville") %}
{% set a = a|default("underline underline-offset-2 transition-all duration-300 #{fontFamily}") %}
{% set p = p|default("#{spacingClass} #{paragraphFontSize} #{fontFamily}") %}
{% set ul = ul|default("space-y-1 #{markerColor[background]} #{listStyle} #{paragraphFontSize} #{listPaddingLeft} #{fontFamily}") %}
{% set ol = ol|default("space-y-1 list-decimal #{markerColor[background]} #{listStyle} #{paragraphFontSize} #{listPaddingLeft} #{fontFamily}") %}
{% set li = li|default("") %}
{% set hr = hr|default("my-6 #{borderClass} #{fontFamily}") %}
{% set blockquote = blockquote|default("rounded-tr rounded-br border border-l-4 bg-transparent p-5 pl-3.5 #{blockquoteClass} #{fontFamily}") %}
{% set pre = pre|default("mb-4 p-4 block whitespace-pre overflow-x-scroll bg-gray-50 text-sm #{fontFamily}") %}
{% set iframeFigure = iframeFigure|default("mb-4 aspect-w-16 aspect-h-9 #{fontFamily}") %}
{% set figureTable = table|default("min-w-full whitespace-nowrap lg:whitespace-normal #{fontFamily}") %}
{% set table = table|default("min-w-full whitespace-nowrap lg:whitespace-normal border border-collapse border-blue-100 #{fontFamily}") %}
{% set thead = thead|default("border-b border-blue-100") %}
{% set th = th|default('px-1.5 py-2 text-sm') %}
{% set td = td|default('px-2 py-3.5') %}
{% set tr = tr|default("!text-blue-800 #{tableBorder}") %}
{% set checkedCheckboxClass = input|default("h-5 w-5 rounded border bg-transparent !shadow-none !outline-none !ring-0 !ring-offset-0 checked:bg-[length:90%_90%] mr-1.5 #{checkboxColor[background]}") %}
{% set uncheckedCheckboxClass = input|default("h-5 w-5 rounded border bg-transparent !shadow-none !outline-none !ring-0 !ring-offset-0 mr-1.5 #{checkboxColor[background]}") %}

{{ text|replace({
    "<h1": "<h1 class='#{h1} #{classes} #{color}'",
    "<h2": "<h2 class='#{h2} #{classes} #{color}'",
    "<h3": "<h3 class='#{h3} #{classes} #{color}'",
    "<h4": "<h4 class='#{h4} #{classes} #{color}'",
    "<h5": "<h5 class='#{h5} #{classes} #{color}'",
    "<h6": "<h6 class='#{h6} #{classes} #{color}'",
    "<pre": "<pre class='#{pre} #{classes} #{color}'",
    "<a": "<a class='#{a} #{classes} #{linkColor}'",
    "<p": "<p class='#{p} #{classes} #{color}'",
    "<ul": "<ul class='#{ul} #{classes} #{color}'",
    "<ol": "<ol class='#{ol} #{classes} #{color}'",
    "<li": "<li class='#{li} #{classes} #{color}'",
    "<hr": "<hr class='#{hr} #{classes} #{color}'",
    '<figure class="table">': "<figure class='#{figureTable} #{classes} #{color}'>",
    "<table": "<table class='#{table} #{classes} #{color}'",
    "<thead": "<thead class='#{thead} #{classes} #{color}'",
    "<th": "<th class='#{th} #{classes}'",
    "<td": "<td class='#{td} #{classes}'",
    "<tr": "<tr class='#{tr} #{classes}'",
    '<input type="checkbox" checked="checked"': "<input type='checkbox' checked='checked' class='#{checkedCheckboxClass}'",
    '<input type="checkbox" disabled="disabled"': "<input type='checkbox' disabled='disabled' class='#{uncheckedCheckboxClass}'",
    "<figure><iframe" : "<figure class='#{iframeFigure} #{classes} #{color}'><iframe class='!h-full !w-full'",
    "<blockquote><p>" : "<figure><blockquote class='#{blockquote} #{classes} #{color}'>“",
    "</p></blockquote>" : "”</blockquote></figure>",
})|raw }}